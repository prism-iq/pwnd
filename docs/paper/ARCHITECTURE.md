# Architecture Diagrams

> ASCII art representations of the Self-Evolving AI Agent architecture.

---

## 1. High-Level System Architecture

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                        SELF-EVOLVING AI AGENT                                 ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────┐    ║
║   │                         USER INTERFACE                               │    ║
║   │                    (ChatGPT-style Web App)                          │    ║
║   │   ┌──────────────┐  ┌──────────────────────────────────────────┐   │    ║
║   │   │   Sidebar    │  │              Chat Window                  │   │    ║
║   │   │ - History    │  │  User: "Who flew with Epstein?"          │   │    ║
║   │   │ - Settings   │  │  Agent: Based on flight logs...          │   │    ║
║   │   │ - Export     │  │         [Source: EFTA00001234]           │   │    ║
║   │   └──────────────┘  └──────────────────────────────────────────┘   │    ║
║   └─────────────────────────────────────────────────────────────────────┘    ║
║                                      │                                        ║
║                                      ▼                                        ║
║   ┌─────────────────────────────────────────────────────────────────────┐    ║
║   │                          API LAYER                                   │    ║
║   │                     (FastAPI + Python)                              │    ║
║   │                                                                      │    ║
║   │   POST /api/query  ──────▶  Search + Synthesize  ──────▶  Response │    ║
║   │   GET  /api/health ──────▶  Status Check         ──────▶  OK       │    ║
║   │                                                                      │    ║
║   └───────────────────────────────┬─────────────────────────────────────┘    ║
║                                   │                                           ║
║              ┌────────────────────┼────────────────────┐                     ║
║              ▼                    ▼                    ▼                     ║
║   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐          ║
║   │   SEARCH ENGINE  │  │   LLM LAYER      │  │   MEMORY LAYER   │          ║
║   │   (SQLite FTS5)  │  │   (Claude API)   │  │   (Markdown)     │          ║
║   │                  │  │                  │  │                  │          ║
║   │  - 15,549 docs   │  │  - Haiku: fast   │  │  - thoughts.md   │          ║
║   │  - BM25 ranking  │  │  - Opus: deep    │  │  - methods.md    │          ║
║   │  - FTS index     │  │  - Synthesis     │  │  - errors.md     │          ║
║   │                  │  │                  │  │  - prompt.md     │          ║
║   └──────────────────┘  └──────────────────┘  └──────────────────┘          ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

## 2. The Cognitive Loop

```
                           ╔═══════════════════╗
                           ║    USER INPUT     ║
                           ║  "Fix the bug"    ║
                           ╚═════════╤═════════╝
                                     │
                                     ▼
┌────────────────────────────────────────────────────────────────────────────────┐
│                                                                                │
│   ╔════════════════╗         ╔════════════════╗         ╔════════════════╗   │
│   ║   1. READ      ║         ║   2. THINK     ║         ║   3. WRITE     ║   │
│   ║   MEMORY       ║────────▶║   (PROCESS)    ║────────▶║   MEMORY       ║   │
│   ╚════════════════╝         ╚════════════════╝         ╚════════════════╝   │
│          │                          │                          │              │
│          │                          │                          │              │
│          ▼                          ▼                          ▼              │
│   ┌──────────────┐          ┌──────────────┐          ┌──────────────┐       │
│   │ thoughts.md  │          │   Claude     │          │ Log insight  │       │
│   │ methods.md   │          │   Opus 4.5   │          │ Add method   │       │
│   │ errors.md    │          │   200K ctx   │          │ Record error │       │
│   │ prompt.md    │          │              │          │ Update prompt│       │
│   └──────────────┘          └──────────────┘          └──────────────┘       │
│                                                                                │
│                         THE COGNITIVE LOOP                                     │
└────────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
                           ╔═══════════════════╗
                           ║  AGENT OUTPUT     ║
                           ║  "Bug fixed..."   ║
                           ╚═══════════════════╝
```

---

## 3. Memory Layer Stack

```
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │                         MEMORY LAYER STACK                              │
    │                                                                         │
    │    ╔═══════════════════════════════════════════════════════════════╗   │
    │    ║  LAYER 4: EXTERNAL KNOWLEDGE                                  ║   │
    │    ║  ───────────────────────────────────────────────────────────  ║   │
    │    ║  • Document corpus (15,549 files)                            ║   │
    │    ║  • Flight logs, depositions, transcripts                      ║   │
    │    ║  • Searchable via SQLite FTS5                                ║   │
    │    ╚═══════════════════════════════════════════════════════════════╝   │
    │                                   ▲                                     │
    │                                   │ references                          │
    │    ╔═══════════════════════════════════════════════════════════════╗   │
    │    ║  LAYER 3: BEHAVIORAL (system_prompt.md)                       ║   │
    │    ║  ───────────────────────────────────────────────────────────  ║   │
    │    ║  • Self-modifiable instructions                               ║   │
    │    ║  • Quality standards                                          ║   │
    │    ║  • Anti-patterns to avoid                                     ║   │
    │    ║  • Evolution log                                              ║   │
    │    ╚═══════════════════════════════════════════════════════════════╝   │
    │                                   ▲                                     │
    │                                   │ informs                             │
    │    ╔═══════════════════════════════════════════════════════════════╗   │
    │    ║  LAYER 2: PROCEDURAL (methods.md + errors.md)                 ║   │
    │    ║  ───────────────────────────────────────────────────────────  ║   │
    │    ║  methods.md:                    errors.md:                     ║   │
    │    ║  • Working patterns             • Failure records              ║   │
    │    ║  • Code snippets                • Root cause analysis          ║   │
    │    ║  • Best practices               • Prevention rules             ║   │
    │    ╚═══════════════════════════════════════════════════════════════╝   │
    │                                   ▲                                     │
    │                                   │ abstracts                           │
    │    ╔═══════════════════════════════════════════════════════════════╗   │
    │    ║  LAYER 1: EPISODIC (thoughts.md)                              ║   │
    │    ║  ───────────────────────────────────────────────────────────  ║   │
    │    ║  • Timestamped entries                                        ║   │
    │    ║  • Reasoning traces                                           ║   │
    │    ║  • Hypotheses and validations                                 ║   │
    │    ║  • Current state awareness                                    ║   │
    │    ╚═══════════════════════════════════════════════════════════════╝   │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Self-Improvement Feedback Loop

```
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                    SELF-IMPROVEMENT LOOP                                │
    │                                                                         │
    │         ┌───────────────────────────────────────────────────┐          │
    │         │                                                   │          │
    │         ▼                                                   │          │
    │    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐   │          │
    │    │  EXECUTE    │───▶│  EVALUATE   │───▶│  SUCCEEDED? │   │          │
    │    │  TASK       │    │  RESULT     │    │             │   │          │
    │    └─────────────┘    └─────────────┘    └──────┬──────┘   │          │
    │                                                 │           │          │
    │                              ┌─────────────────┬┴───────────┤          │
    │                              │                 │            │          │
    │                              ▼                 ▼            │          │
    │                         ┌─────────┐      ┌─────────┐       │          │
    │                         │   YES   │      │   NO    │       │          │
    │                         └────┬────┘      └────┬────┘       │          │
    │                              │                │            │          │
    │                              ▼                ▼            │          │
    │                    ┌──────────────┐    ┌──────────────┐   │          │
    │                    │ Log to       │    │ Log to       │   │          │
    │                    │ methods.md   │    │ errors.md    │   │          │
    │                    │ "This works" │    │ "This failed"│   │          │
    │                    └──────────────┘    └──────┬───────┘   │          │
    │                                               │           │          │
    │                                               ▼           │          │
    │                                    ┌──────────────────┐   │          │
    │                                    │ PATTERN EMERGED? │   │          │
    │                                    │ (3+ occurrences) │   │          │
    │                                    └────────┬─────────┘   │          │
    │                                             │             │          │
    │                              ┌──────────────┴─────────────┤          │
    │                              │                            │          │
    │                              ▼                            │          │
    │                    ┌──────────────────┐                   │          │
    │                    │ UPDATE           │                   │          │
    │                    │ system_prompt.md │                   │          │
    │                    │ "Avoid pattern X"│                   │          │
    │                    └────────┬─────────┘                   │          │
    │                             │                             │          │
    │                             └─────────────────────────────┘          │
    │                                                                       │
    └───────────────────────────────────────────────────────────────────────┘
```

---

## 5. Document Flow

```
    ╔══════════════════════════════════════════════════════════════════════════╗
    ║                         DOCUMENT FLOW                                    ║
    ╠══════════════════════════════════════════════════════════════════════════╣
    ║                                                                          ║
    ║   INGESTION                                                              ║
    ║   ─────────                                                              ║
    ║                                                                          ║
    ║   ┌───────────┐    ┌───────────┐    ┌───────────┐    ┌───────────┐     ║
    ║   │ Archives  │───▶│ Extract   │───▶│ Convert   │───▶│ Chunk     │     ║
    ║   │ .tar.gz   │    │ files     │    │ to text   │    │ content   │     ║
    ║   │ .zip      │    │           │    │ (pdftotext)│    │ (10KB)   │     ║
    ║   └───────────┘    └───────────┘    └───────────┘    └─────┬─────┘     ║
    ║                                                            │            ║
    ║                                                            ▼            ║
    ║   STORAGE                                                               ║
    ║   ───────                                                               ║
    ║                                                                          ║
    ║   ┌─────────────────────────────────────────────────────────────────┐   ║
    ║   │                      SQLite Database                             │   ║
    ║   │  ┌────────────────────────────────────────────────────────────┐ │   ║
    ║   │  │ documents table                                            │ │   ║
    ║   │  │ ───────────────                                            │ │   ║
    ║   │  │ id | filename           | source     | created_at         │ │   ║
    ║   │  │ 1  | EFTA00001234.pdf   | foia       | 2026-01-09         │ │   ║
    ║   │  └────────────────────────────────────────────────────────────┘ │   ║
    ║   │  ┌────────────────────────────────────────────────────────────┐ │   ║
    ║   │  │ contents table (+ FTS5 index)                              │ │   ║
    ║   │  │ ─────────────────────────────                              │ │   ║
    ║   │  │ doc_id | chunk_idx | full_text                             │ │   ║
    ║   │  │ 1      | 0         | "Flight manifest showing..."          │ │   ║
    ║   │  └────────────────────────────────────────────────────────────┘ │   ║
    ║   └─────────────────────────────────────────────────────────────────┘   ║
    ║                                      │                                   ║
    ║                                      ▼                                   ║
    ║   RETRIEVAL                                                              ║
    ║   ─────────                                                              ║
    ║                                                                          ║
    ║   ┌───────────┐    ┌───────────┐    ┌───────────┐    ┌───────────┐     ║
    ║   │ User      │───▶│ FTS5      │───▶│ Rank by   │───▶│ Return    │     ║
    ║   │ query     │    │ MATCH     │    │ BM25      │    │ top 30    │     ║
    ║   │           │    │           │    │           │    │           │     ║
    ║   └───────────┘    └───────────┘    └───────────┘    └───────────┘     ║
    ║                                                                          ║
    ╚══════════════════════════════════════════════════════════════════════════╝
```

---

## 6. API Request Flow

```
                                USER
                                 │
                                 │ POST /api/query
                                 │ {"q": "Who flew with Epstein?"}
                                 ▼
    ┌────────────────────────────────────────────────────────────────────────┐
    │                          FastAPI Router                                │
    │                                                                        │
    │   @router.post("/api/query")                                          │
    │   async def query_post(request: QueryRequest):                        │
    └────────────────────────────────┬───────────────────────────────────────┘
                                     │
                    ┌────────────────┴────────────────┐
                    ▼                                 ▼
    ┌───────────────────────────┐     ┌───────────────────────────┐
    │    1. SEARCH DOCUMENTS    │     │    2. READ MEMORY         │
    │    ──────────────────     │     │    ────────────           │
    │                           │     │                           │
    │    SELECT * FROM          │     │    thoughts.md            │
    │    contents_fts           │     │    methods.md             │
    │    WHERE MATCH "epstein"  │     │    errors.md              │
    │                           │     │    system_prompt.md       │
    │    Returns: 30 docs       │     │                           │
    └─────────────┬─────────────┘     └─────────────┬─────────────┘
                  │                                 │
                  └────────────────┬────────────────┘
                                   ▼
    ┌────────────────────────────────────────────────────────────────────────┐
    │                        3. LLM SYNTHESIS                                │
    │                        ────────────────                                │
    │                                                                        │
    │    Prompt:                                                             │
    │    "Given these documents and your memory,                            │
    │     answer: Who flew with Epstein?"                                   │
    │                                                                        │
    │    Documents: [30 relevant excerpts]                                  │
    │    Memory: [recent thoughts, methods, errors]                         │
    │                                                                        │
    │                           │                                            │
    │                           ▼                                            │
    │                    Claude Haiku API                                    │
    │                           │                                            │
    │                           ▼                                            │
    │    Response: "Based on flight logs EFTA00001234..."                   │
    └────────────────────────────────┬───────────────────────────────────────┘
                                     │
                                     ▼
    ┌────────────────────────────────────────────────────────────────────────┐
    │                        4. LOG & RESPOND                                │
    │                        ────────────────                                │
    │                                                                        │
    │    • Write query to thoughts.md                                       │
    │    • If error, log to errors.md                                       │
    │    • Return JSON response to user                                     │
    └────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
                                USER
                                 │
                                 │ {"answer": "Based on flight logs...",
                                 │  "sources": ["EFTA00001234"]}
```

---

*These diagrams represent the architecture as of 2026-01-10. The system evolves; so do these diagrams.*
